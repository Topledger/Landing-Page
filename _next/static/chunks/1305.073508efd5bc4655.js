"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1305],{1305:function(a,b,c){c.r(b),c.d(b,{default:function(){return p}});var d=c(2540),e=c(7294);let f={weekly:"weeks",daily:"days",monthly:"months"};function g(a){let b={};return d._.each(a,a=>{let c=(0,d.d)(a.date),e=c.valueOf();b[e]=b[e]||{date:c,total:parseInt(a.total,10)||0,values:{}},b[e].values[a.stage]=parseInt(a.value,10)||null}),d._.values(b)}let h={daily:"days",weekly:"weeks",monthly:"months",yearly:"years"},i={daily:"MMMM D, YYYY",weekly:"[Week of] MMM D, YYYY",monthly:"MMMM YYYY",yearly:"YYYY"},j={initialDate:null,timeInterval:"monthly",noValuePlaceholder:"-",rawNumberOnHover:!0,displayAbsoluteValues:!1,initialIntervalNumber:1,maxColumns:1/0,title:null,timeColumnTitle:"Time",peopleColumnTitle:"People",stageColumnTitle:"{{ @ }}",numberFormat:"0,0[.]00",percentFormat:"0.00%",timeLabelFormat:i.monthly,colors:{min:"#ffffff",max:"#041d66",steps:7}};function k(a){return a=(0,d.i)(a),d.i.contrast(a,"#ffffff")<d.i.contrast(a,"#000000")}function l(a,b){return(0,d.f)(a.stageColumnTitle,{"@":a.initialIntervalNumber-1+b})}function m({options:a,maxRowLength:b}){let c=[];for(let e=1;e<b;e+=1)c.push(d.j.jsx("th",{className:"cornelius-stage",children:l(a,e)},`col${e}`));return d.j.jsxs("tr",{children:[d.j.jsx("th",{className:"cornelius-time",children:a.timeColumnTitle}),d.j.jsx("th",{className:"cornelius-people",children:a.peopleColumnTitle}),c]})}function n({options:a,data:b,index:c,maxRowLength:e}){let f=b[0]||0,g=[];for(let i=1;i<e;i+=1){let j=b[i],l=d.l.isFinite(j/f)?j/f*100:null,m={key:`col${i}`};if(d.l.isNil(l))m.className="cornelius-empty",m.children=a.noValuePlaceholder;else{m.className=a.displayAbsoluteValues?"cornelius-absolute":"cornelius-percentage",m.children=a.displayAbsoluteValues?a.formatNumber(j):a.formatPercent(l);let n=a.getColorForValue(l);m.style={backgroundColor:n,color:(0,d.b)(n)},k(m.style.color)&&(m.className+=" cornelius-white-text"),a.rawNumberOnHover&&!a.displayAbsoluteValues&&(m.children=d.j.jsx(d.T,{title:a.formatNumber(j),mouseEnterDelay:0,mouseLeaveDelay:0,children:d.j.jsx("div",{children:m.children})}))}g.push(d.j.jsx("td",{...m}))}return d.j.jsxs("tr",{children:[d.j.jsx("td",{className:"cornelius-label",children:function(a,b){let c=h[a.timeInterval];return a.initialDate.clone().add(b,c).format(a.timeLabelFormat)}(a,c)}),d.j.jsx("td",{className:"cornelius-people",children:a.formatNumber(f)}),g]})}function o({data:a,options:b}){b=(0,e.useMemo)(()=>{var a;return a=b,a=d.l.extend({},j,a,{initialDate:(0,d.d)(a.initialDate),colors:d.l.extend({},j.colors,a.colors)}),d.l.extend(a,{timeLabelFormat:i[a.timeInterval],formatNumber:(0,d.e)(a.numberFormat),formatPercent:(0,d.e)(a.percentFormat),getColorForValue:d.i.scale([a.colors.min,a.colors.max]).mode("hsl").domain([0,100]).classes(a.colors.steps)})},[b]);let c=(0,e.useMemo)(()=>d.l.min([d.l.max(d.l.map(a,a=>a.length))||0,b.maxColumns+1]),[a,b.maxColumns]);return 0===a.length?null:d.j.jsxs("div",{className:"cornelius-container",children:[b.title&&d.j.jsx("div",{className:"cornelius-title",children:b.title}),d.j.jsxs("table",{className:"cornelius-table",children:[d.j.jsx("thead",{children:d.j.jsx(m,{options:b,maxRowLength:c})}),d.j.jsx("tbody",{children:d.l.map(a,(a,e)=>d.j.jsx(n,{options:b,data:a,index:e,maxRowLength:c},`row${e}`))})]})]})}function p({data:a,options:b}){let{data:c,initialDate:h}=(0,e.useMemo)(()=>(function(a,b){if(!function(a,b){let c=d._.map(a.columns,a=>a.name);return a.rows.length>0&&d._.includes(c,b.dateColumn)&&d._.includes(c,b.stageColumn)&&d._.includes(c,b.totalColumn)&&d._.includes(c,b.valueColumn)}(a,b))return{data:[],initialDate:null};a=d._.map(a.rows,a=>({date:a[b.dateColumn],stage:parseInt(a[b.stageColumn],10),total:parseFloat(a[b.totalColumn]),value:parseFloat(a[b.valueColumn])}));let c=d._.sortBy(a,a=>a.date+a.stage),e=(0,d.d)(c[0].date).toDate(),h;return{data:h="simple"===b.mode?function(a,b){let c=b.timeInterval,e=g(a),h=d._.map(a,a=>a.stage),i=d._.min(h),j=d._.max(h),k=null,l=[];return d._.each(e,a=>{if(null!==k){let b=Math.abs(k.diff(a.date,f[c]));for(;b>1;)l.push([0]),b-=1}k=a.date;let d=[a.total];for(let e=i;e<=j;e+=1)d.push(a.values[e]);l.push(d)}),l}(c,b):function(a,b){let c=b.timeInterval,e=g(a),h=d._.min(d._.map(a,a=>a.stage)),i=(0,d.d)(d._.last(e).date).diff(d._.first(e).date,f[c]),j=h+i,k=null,l=[];return d._.each(e,a=>{if(null!==k){let b=Math.abs(k.diff(a.date,f[c]));for(;b>1;){let d=[0];for(let e=h;e<=j;e+=1)d.push(a.values[e]||0);l.push(d),j-=1,b-=1}}k=a.date;let g=[a.total];for(let i=h;i<=j;i+=1)g.push(a.values[i]||0);j-=1,l.push(g)}),l}(c,b),initialDate:e}})(a,b),[a,b]),i=(0,e.useMemo)(()=>({initialDate:h,timeInterval:b.timeInterval,noValuePlaceholder:b.noValuePlaceholder,rawNumberOnHover:b.showTooltips,displayAbsoluteValues:!b.percentValues,timeColumnTitle:b.timeColumnTitle,peopleColumnTitle:b.peopleColumnTitle,stageColumnTitle:b.stageColumnTitle,numberFormat:b.numberFormat,percentFormat:b.percentFormat,colors:b.colors}),[b,h]);return 0===c.length?null:d.j.jsx("div",{className:"cohort-visualization-container",children:d.j.jsx(o,{data:c,options:i})})}o.defaultProps={data:[],options:{}},p.propTypes=d.R}}])