"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[966,9799],{966:function(a,b,c){c.r(b),c.d(b,{default:function(){return j}});var d=c(2540),e=c(7294),f=c(9799),g=c(5078);function h(a){return a.y+a.dy/2}function i(a){return a.value}function j({data:a}){let[b,c]=(0,e.useState)(null),j=(0,e.useMemo)(()=>(function(a){var b,c;if(a.rows=(b=a.rows,d.l.map(b,a=>d.l.mapValues(a,a=>!a||d.l.isNumber(a)||d.l.isNaN(parseFloat(a))?a:parseFloat(a)))),!((c=a)&&d.l.find(c.columns,a=>"value"===a.name)&&d.l.every(c.rows,a=>d.l.every(a,a=>!!(!a||d.l.isString(a))||isFinite(a)))))return a=>{g.select(a).selectAll("*").remove()};a=function(a){let b={},c={},e=[],f=d.l.sortBy(d.l.filter(d.l.keys(a[0]),a=>"value"!==a),d.l.identity);function h(a,c){var f;a=(f=a,d.l.isNil(f)?"Exit":""+f);let g=`${a}:${String(c)}`,h=b[g];return h||((h={name:a}).id=e.push(h)-1,b[g]=h),h}function i(a,b,d,e){var f,g;if((""===a||!a)&&e>1)return;let i,j=h(a,e),k=h(b,e+1),l=(f=j.id,(i=c[[f,g=k.id]])||(i={target:g,source:f,value:0},c[[f,g]]=i),i);l.value+=parseInt(d,10)}a.forEach(a=>{i(a[f[0]],a[f[1]],a.value||0,1),i(a[f[1]],a[f[2]],a.value||0,2),i(a[f[2]],a[f[3]],a.value||0,3),i(a[f[3]],a[f[4]],a.value||0,4),i(a[f[4]],null,a.value||0,5)});let j=g.scale.category20();return{nodes:d.l.map(e,a=>d.l.extend(a,{color:j(a.name.replace(/ .*/,""))})),links:d.l.values(c)}}(a.rows);let e=a=>g.format(",.0f")(a);return b=>{g.select(b).selectAll("*").remove();let c={top:10,right:10,bottom:10,left:10},f=b.offsetWidth-c.left-c.right,j=b.offsetHeight-c.top-c.bottom;if(f<=0||j<=0)return;let k=g.select(b).append("svg").attr("class","sankey").attr("width",f+c.left+c.right).attr("height",j+c.top+c.bottom).append("g").attr("transform",`translate(${c.left},${c.top})`),l=(function(){let a={},b=24,c=8,d=[1,1],e=[],f=[];function j(){function a(a,b){return a.source.y-b.source.y}function b(a,b){return a.target.y-b.target.y}e.forEach(c=>{c.sourceLinks.sort(b),c.targetLinks.sort(a)}),e.forEach(a=>{let b=0,c=0;a.sourceLinks.forEach(a=>{a.sy=b,b+=a.dy}),a.targetLinks.forEach(a=>{a.ty=c,c+=a.dy})})}return a.nodeWidth=function(c){return arguments.length?(b=+c,a):b},a.nodePadding=function(b){return arguments.length?(c=+b,a):c},a.nodes=function(b){return arguments.length?(e=b,a):e},a.links=function(b){return arguments.length?(f=b,a):f},a.size=function(b){return arguments.length?(d=b,a):d},a.layout=function(k){return e.forEach(a=>{a.sourceLinks=[],a.targetLinks=[]}),f.forEach(a=>{let b=a.source,c=a.target;"number"==typeof b&&(b=a.source=e[a.source]),"number"==typeof c&&(c=a.target=e[a.target]),b.sourceLinks.push(a),c.targetLinks.push(a)}),e.forEach(a=>{a.value=Math.max(g.sum(a.sourceLinks,i),g.sum(a.targetLinks,i))}),function(){var a,c;let f=e,h,i=0;function j(a){a.x=i,a.dx=b,a.sourceLinks.forEach(a=>{0>h.indexOf(a.target)&&h.push(a.target)})}for(;f.length;)h=[],f.forEach(j),f=h,i+=1;a=i,e.forEach(b=>{b.sourceLinks.length||(b.x=a-1)}),i=Math.max(g.max(e,a=>a.x),2),c=(d[0]-b)/(i-1),e.forEach(a=>{a.x*=c})}(),function(a){let b=g.nest().key(a=>a.x).sortKeys(g.ascending).entries(e).map(a=>a.values);function j(a){function c(a){return h(a.source)*a.value}b.forEach(b=>{b.forEach(b=>{if(b.targetLinks.length){let d=g.sum(b.targetLinks,c)/g.sum(b.targetLinks,i);b.y+=(d-h(b))*a}})})}function k(){b.forEach(a=>{let b=a.length,e,f,g=0,h;for(a.sort(n),h=0;h<b;++h)(f=g-(e=a[h]).y)>0&&(e.y+=f),g=e.y+e.dy+c;if((f=g-c-d[1])>0)for(g=e.y-=f,h=b-2;h>=0;--h)(f=(e=a[h]).y+e.dy+c-g)>0&&(e.y-=f),g=e.y})}(function(){let a=g.min(b,a=>(d[1]-(a.length-1)*c)/g.sum(a,i));b.forEach(b=>{b.forEach((b,c)=>{b.y=c,b.dy=b.value*a})}),f.forEach(b=>{b.dy=b.value*a})})(),k();for(let l=1;a>0;a-=1)m(l*=.99),k(),j(l),k();function m(a){b.slice().reverse().forEach(b=>{b.forEach(b=>{if(b.sourceLinks.length){let d=g.sum(b.sourceLinks,c)/g.sum(b.sourceLinks,i);b.y+=(d-h(b))*a}})});function c(a){return h(a.target)*a.value}}function n(a,b){return a.y-b.y}}(k),j(),a},a.relayout=function(){return j(),a},a.link=function(){let a=.5;function b(b){let c=b.source.x+b.source.dx,d=b.target.x,e=g.interpolateNumber(c,d),f=e(a),h=e(1-a),i=b.source.y+b.sy+b.dy/2,j=b.target.y+b.ty+b.dy/2;return`M${c},${i}C${f},${i} ${h},${j} ${d},${j}`}return b.curvature=c=>arguments.length?(a=+c,b):a,b},a})().nodeWidth(15).nodePadding(10).size([f,j]),m=l.link();l.nodes(a.nodes).links(a.links).layout(0),function(a,b){g.nest().key(a=>a.x).entries(b.nodes).map(a=>a.values).forEach(b=>{b=d.l.filter(d.l.sortBy(b,a=>-a.value),a=>"Exit"!==a.name);let c=g.sum(b,a=>a.dy),e=(a-c)/b.length;d.l.reduce(b,(a,b)=>(b.y=a,a+b.dy+e),0)})}(j,a),l.relayout();let n=k.append("g").selectAll(".link").data(a.links).enter().append("path").filter(a=>"Exit"!==a.target.name).attr("class","link").attr("d",m).style("stroke-width",a=>Math.max(1,a.dy)).sort((a,b)=>b.dy-a.dy);n.append("title").text(a=>`${a.source.name} â†’ ${a.target.name}
${e(a.value)}`);let o=k.append("g").selectAll(".node").data(a.nodes).enter().append("g").filter(a=>"Exit"!==a.name).attr("class","node").attr("transform",a=>`translate(${a.x},${a.y})`);o.on("mouseover",function(a){let b=function(a){console.log(a);let b=[];return a.sourceLinks.forEach(a=>{b.push(a.target)}),a.targetLinks.forEach(a=>{b.push(a.source)}),b}(a);b=d.l.map(b,a=>a.id),o.filter(c=>c!==a&&!d.l.includes(b,c.id)).style("opacity",.2),n.filter(b=>!(d.l.includes(a.sourceLinks,b)||d.l.includes(a.targetLinks,b))).style("opacity",.2)}).on("mouseout",function(){o.style("opacity",1),n.style("opacity",1)}),o.append("rect").attr("height",a=>a.dy).attr("width",l.nodeWidth()).style("fill",a=>a.color).style("stroke",a=>g.rgb(a.color).darker(2)).append("title").text(a=>`${a.name}
${e(a.value)}`),o.append("text").attr("x",-6).attr("y",a=>a.dy/2).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text(a=>a.name).filter(a=>a.x<f/2).attr("x",6+l.nodeWidth()).attr("text-anchor","start")}})(a),[a]);return(0,e.useEffect)(()=>{if(b)return j(b),(0,f.o)(b,()=>{j(b)})},[b,j]),d.j.jsx("div",{className:"sankey-visualization-container",ref:c})}j.propTypes=d.R},9799:function(a,b,c){c.d(b,{o:function(){return f}});let d=new Map;function e(){d.size>0&&(d.forEach((a,b)=>{let c=b.getBoundingClientRect(),d=Math.round(10*c.width),e=Math.round(10*c.height);(a.width!==d||a.height!==e)&&(a.width=d,a.height=e,a.callback(b))}),setTimeout(e,100))}function f(a,b){if(a&&!d.has(a)){let c=0===d.size;return d.set(a,{callback:b}),c&&e(),()=>d.delete(a)}return()=>{}}}}])